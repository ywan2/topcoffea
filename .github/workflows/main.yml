name: CI

on:
  push:
 # schedule:
 #   - cron: '0 1 * * *' # Test every day at 1AM
  
jobs:
  Full_analysis:
    runs-on: ubuntu-latest
    steps: 
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Add conda to system path
        run: |
          echo $CONDA/bin >> $GITHUB_PATH

      - name: Install dependencies
        run: |
          conda env update --file environment.yml --name base

      - name: List conda
        run: |
          conda list

      - name: Install topcoffea package
        run: |
          pip install -e .

      - name: Download root files
        run: |
          wget http://www.crc.nd.edu/~ywan2/root_files/NAOD-00000_18449.root


#  Methods to submit workers
#          work_queue_worker -M $USER-wq-topcoffea --single-shot &
#          work_queue_worker -M $USER-workqueue-coffea --single-shot &
#          work_queue_worker -d all -o worker.log localhost 9123 &
#          condor_submit_workers -M ${USER}-workqueue-coffea -t 900 --cores 8 --memory 80000 --disk 100000  6

      - name: Run processors over test files
        run: |
          cd analysis/topEFT
          bash test_workers.sh
#          work_queue_worker -M $USER-workqueue-coffea --single-shot &
#          time python work_queue_run.py ../../topcoffea/json/test_samples/UL17_private_ttH_for_CI.json -o output_check_yields

#      - name: Run processors over test files
#        run: |
#          cd analysis/topEFT
#          time python run.py ../../topcoffea/json/test_samples/UL17_private_ttH_for_CI.json -o output_check_yields

#      - name: Get yields 
#        run: |
#          cd analysis/topEFT
#          python get_yield_json.py -f histos/output_check_yields.pkl.gz -n output_check_yields

#      - name: Compare yields
#        run: |
#          cd analysis/topEFT
#          python comp_yields.py test/UL17_private_ttH_for_CI_yields.json output_check_yields.json -t1 "Ref yields" -t2 "New yields"

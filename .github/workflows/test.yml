name: CI

on: push

stages:
  - stage: A 
    jobs:
     - job-1:
       runs-on: ubuntu-latest
       steps:
        - name: Checkout repository
          uses: actions/checkout@v2

        - name: Add conda to system path
          run: |
            echo $CONDA/bin >> $GITHUB_PATH
 
        - name: Install dependencies
          run: |
            conda env update --file environment.yml --name base

        - name: Conda list
          run: |
            conda list

  - stage: B
    jobs:
     - job-2:
       needs: job-1
       runs-on: ubuntu-latest
       steps:
        - name: Submit workers
          run: |
            work_queue_worker -M $USER-wq-topcoffea --single-shot

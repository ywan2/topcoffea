name: CI

on: push

stages:
      - stage-1
      - stage-2

job-1:
    stage: stage-1
      needs: []
      runs-on: ubuntu-latest
      steps:
        - name: Checkout repository
          uses: actions/checkout@v2

        - name: Add conda to system path
          run: |
            echo $CONDA/bin >> $GITHUB_PATH

        - name: Install dependencies
          run: |
            conda env update --file environment.yml --name base

        - name: Conda list
          run: |
            conda list

job-2:
    stage: stage-1
    needs: job-1
    runs-on: ubuntu-latest
    steps:
      - name: Submit workers
        run: |
          work_queue_worker -M $USER-wq-topcoffea --single-shot
